<!DOCTYPE html><html lang="ch" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Redis学习笔记（3）：Hash类型基本API | J's Blog</title><meta name="keywords" content="Redis,Redis API"><meta name="author" content="Jiang"><meta name="copyright" content="Jiang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Redis学习笔记（3）：Hash类型基本API1. Hash类型基本介绍&amp;emsp;&amp;emsp;Hash类型是编程语言里最常见的数据结构之一了，几乎所有编程语言都会提供Hash类型Hash有很多中文叫法，最常见的是哈希和字典。&amp;emsp;&amp;emsp;在Redis中，Hash类型是指键值本身是一对键值对结构，value&#x3D;{field1,value1},{f">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis学习笔记（3）：Hash类型基本API">
<meta property="og:url" content="http://example.com/2022/03/24/redis-study-3/index.html">
<meta property="og:site_name" content="J&#39;s Blog">
<meta property="og:description" content="Redis学习笔记（3）：Hash类型基本API1. Hash类型基本介绍&amp;emsp;&amp;emsp;Hash类型是编程语言里最常见的数据结构之一了，几乎所有编程语言都会提供Hash类型Hash有很多中文叫法，最常见的是哈希和字典。&amp;emsp;&amp;emsp;在Redis中，Hash类型是指键值本身是一对键值对结构，value&#x3D;{field1,value1},{f">
<meta property="og:locale">
<meta property="og:image" content="http://example.com/img/AVA.jpg">
<meta property="article:published_time" content="2022-03-24T07:40:55.000Z">
<meta property="article:modified_time" content="2022-05-15T13:31:28.330Z">
<meta property="article:author" content="Jiang">
<meta property="article:tag" content="Redis">
<meta property="article:tag" content="Redis API">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/AVA.jpg"><link rel="shortcut icon" href="/true"><link rel="canonical" href="http://example.com/2022/03/24/redis-study-3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Redis学习笔记（3）：Hash类型基本API',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-15 21:31:28'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/AVA.jpg" onerror="onerror=null;src='/img/AVA.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/WIF2.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">J's Blog</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Redis学习笔记（3）：Hash类型基本API</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-03-24T07:40:55.000Z" title="Created 2022-03-24 15:40:55">2022-03-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-05-15T13:31:28.330Z" title="Updated 2022-05-15 21:31:28">2022-05-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Redis学习笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Redis学习笔记（3）：Hash类型基本API"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Redis学习笔记（3）：Hash类型基本API"><a href="#Redis学习笔记（3）：Hash类型基本API" class="headerlink" title="Redis学习笔记（3）：Hash类型基本API"></a>Redis学习笔记（3）：Hash类型基本API</h1><h2 id="1-Hash类型基本介绍"><a href="#1-Hash类型基本介绍" class="headerlink" title="1. Hash类型基本介绍"></a>1. Hash类型基本介绍</h2><p>&amp;emsp;&amp;emsp;Hash类型是编程语言里最常见的数据结构之一了，几乎所有编程语言都会提供Hash类型Hash有很多中文叫法，最常见的是哈希和字典。<br><br>&amp;emsp;&amp;emsp;在Redis中，Hash类型是指键值本身是一对键值对结构，value&#x3D;{field1,value1},{field2,value2}…。也就是说一个Hash类型，key是指这个Hash类型它的名字，value是一个键值对，但是这个键值对的键名为了区分于key，我们不叫key，而是叫field（这个原因是我猜的），然后一个Hash类型可以拥有多个value（即field-value对）。<br><br>&amp;emsp;&amp;emsp;本篇依然有金毛站长无聊瞎搞试出的奇怪现象与对该现象的源码分析，如果你已经会了API的话可以跳到这段看个乐子哦🍭🍭<br><img src="https://s2.loli.net/2022/03/25/upPlszgdSjoycKW.jpg" alt="《redis开发与运维》 p94"></p>
<hr>
<h2 id="2-Hash类型内部编码简介"><a href="#2-Hash类型内部编码简介" class="headerlink" title="2.Hash类型内部编码简介"></a>2.Hash类型内部编码简介</h2><p>&amp;emsp;&amp;emsp;Hash类型有两种内部编码：</p>
<li>listpack（紧凑列表）：<br>
&emsp;&emsp;·ziplist（压缩列表）：当哈希类型元素个数小于等于hash-max-ziplist-entries 配置（默认512个）、同时所有值都小于等于hash-max-ziplist-value配置（默认64 字节）时，Redis会使用ziplist作为哈希的内部实现，ziplist使用更加紧凑的结构实现多个元素的连续存储，所以在节省内存方面比hashtable更加优秀。<p></p>
<li>hashtable（哈希表）：<br>
&emsp;&emsp;当哈希类型无法满足listpack的条件时，Redis会使用hashtable作为哈希的内部实现，因为此时ziplist的读写效率会下降，而hashtable的读写时间复杂度为O（1）。<p></p>

<p>&amp;emsp;&amp;emsp;注：Redis的Unstable和7.0版本将使用listpack替代hash的ziplist。由于ziplist中有着致命的缺陷-连锁更新，在极端条件下会有着极差的性能，导致整个redis响应变慢。listpack是ziplist结构的改进版，在存储空间上更加节省，而且比ziplist也更精简。</p>
<hr>
<h2 id="3-Hash基本API"><a href="#3-Hash基本API" class="headerlink" title="3. Hash基本API"></a>3. Hash基本API</h2><h3 id="hset命令："><a href="#hset命令：" class="headerlink" title="hset命令："></a>hset命令：</h3><p>&amp;emsp;&amp;emsp;<strong>hset {key} {field} {value}</strong> ，设置值，不存在key则创建该key并添加输入的”field-value”键值对，若该key存在而”field-value”不存在则添加该”field-value”键值对，若已经存在则更新value。添加”field-value”键值对成功则返回1，无添加（如只做更新）则返回0。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 示例</span><br><span class="line">127.0.0.1:6379&gt; hset uid v1 1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hset uid v1 0</span><br><span class="line">(integer) 0</span><br><span class="line"></span><br><span class="line"># hsetnx在field不存在的情况下才能设置值成功</span><br><span class="line">127.0.0.1:6379&gt; hsetnx uid v1 3</span><br><span class="line">(integer) 0</span><br><span class="line"></span><br><span class="line"># v1依然是0</span><br><span class="line">127.0.0.1:6379&gt; hget uid v1</span><br><span class="line">&quot;0&quot;</span><br><span class="line"></span><br><span class="line">#v3不存在，则添加成功返回1</span><br><span class="line">127.0.0.1:6379&gt; hsetnx uid v3 3</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="hmset命令："><a href="#hmset命令：" class="headerlink" title="hmset命令："></a>hmset命令：</h3><p>&amp;emsp;&amp;emsp;<strong>hmset {key} {field1} {value1} {field2} {value2}…</strong> ，批量设置值，成功返回OK。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 示例</span><br><span class="line">127.0.0.1:6379&gt; hmset uid v1 1 v2 2 v3 3</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="hget命令："><a href="#hget命令：" class="headerlink" title="hget命令："></a>hget命令：</h3><p>&amp;emsp;&amp;emsp;<strong>hget {key} {field}</strong> ，获取指定的hash下的”field-value”对的value，存在返回对应的值，不存在返回nil。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 示例</span><br><span class="line">127.0.0.1:6379&gt; hset uid v2 2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hget uid v2</span><br><span class="line">&quot;2&quot;</span><br><span class="line">127.0.0.1:6379&gt; hget uid v4</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="hmget命令："><a href="#hmget命令：" class="headerlink" title="hmget命令："></a>hmget命令：</h3><p>&amp;emsp;&amp;emsp;<strong>hmget {key} {field1} {value1} {field2} {value2}…</strong> ，批量获取值，存在返回对应的值，不存在返回nil。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 示例</span><br><span class="line">127.0.0.1:6379&gt; hmset uid v1 1 v2 2 v3 3</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; hmget uid v1 v2 v3</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;3&quot;</span><br><span class="line">127.0.0.1:6379&gt; hmget uid v3 v4</span><br><span class="line">1) &quot;3&quot;</span><br><span class="line">2) (nil)</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="hdel命令："><a href="#hdel命令：" class="headerlink" title="hdel命令："></a>hdel命令：</h3><p>&amp;emsp;&amp;emsp;<strong>hdel {key} {field1} {field2}…</strong> ，删除field，可以批量删除，返回结果为成功删除field的个数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 示例</span><br><span class="line">127.0.0.1:6379&gt; hset uid v4 1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hset uid v5 3</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hdel uid v4 v5</span><br><span class="line">(integer) 2</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="hlen命令："><a href="#hlen命令：" class="headerlink" title="hlen命令："></a>hlen命令：</h3><p>&amp;emsp;&amp;emsp;<strong>hlen {key}</strong> ，返回该key对应的hash类型的field个数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 示例</span><br><span class="line">127.0.0.1:6379&gt; hset testid v1 1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hset testid v2 2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hlen testid</span><br><span class="line">(integer) 2</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="hexists命令："><a href="#hexists命令：" class="headerlink" title="hexists命令："></a>hexists命令：</h3><p>&amp;emsp;&amp;emsp;<strong>hexists {key} {field}</strong> ，判断field是否存在，存在返回1，不存在返回0。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hset uid v1 1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hexists uid v1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hexists uid v2</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="hkeys命令："><a href="#hkeys命令：" class="headerlink" title="hkeys命令："></a>hkeys命令：</h3><p>&amp;emsp;&amp;emsp;<strong>hkeys {key}</strong> ，返回该key指定的hash类型下的所有field（这个命令叫hfields更恰当），不存在返回(empty array)。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 示例</span><br><span class="line">127.0.0.1:6379&gt; hmset uid v1 1 v2 2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; hkeys uid</span><br><span class="line">1) &quot;v1&quot;</span><br><span class="line">2) &quot;v2&quot;</span><br><span class="line">127.0.0.1:6379&gt; hkeys name</span><br><span class="line">(empty array)</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="hvals命令："><a href="#hvals命令：" class="headerlink" title="hvals命令："></a>hvals命令：</h3><p>&amp;emsp;&amp;emsp;<strong>hkeys {key}</strong> ，返回该key指定的hash类型下的所有value，不存在返回(empty array)。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 示例</span><br><span class="line">127.0.0.1:6379&gt; hmset uid v1 1 v2 2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; hvals uid</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">127.0.0.1:6379&gt; hvals name</span><br><span class="line">(empty array)</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="hgetall命令："><a href="#hgetall命令：" class="headerlink" title="hgetall命令："></a>hgetall命令：</h3><p>&amp;emsp;&amp;emsp;<strong>hgetall {key}</strong> ，返回该key指定的hash类型下的所有field-value，不存在返回(empty array)。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 示例</span><br><span class="line">127.0.0.1:6379&gt; hmset uid v1 1 v2 2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; hgetall uid</span><br><span class="line">1) &quot;v1&quot;</span><br><span class="line">2) &quot;1&quot;</span><br><span class="line">3) &quot;v2&quot;</span><br><span class="line">4) &quot;2&quot;</span><br><span class="line">127.0.0.1:6379&gt; hgetall name</span><br><span class="line">(empty array)</span><br></pre></td></tr></table></figure>
<p>&amp;emsp;&amp;emsp;在使用hgetall时，如果哈希元素个数比较多，会存在阻塞Redis的可能。如果开发人员只需要获取部分field，可以使用hmget，如果一定要获取全部field-value，可以使用hscan命令，该命令会渐进式遍历哈希类型。渐进式遍历命令包含有scan,hscan,sscan,zscan，金毛站长会仔细学习后放到以后的篇章专门提起。</p>
<hr>
<h3 id="hincrby-x2F-hincrbyfloat命令："><a href="#hincrby-x2F-hincrbyfloat命令：" class="headerlink" title="hincrby&#x2F;hincrbyfloat命令："></a>hincrby&#x2F;hincrbyfloat命令：</h3><p>&amp;emsp;&amp;emsp;<strong>hincrby&#x2F;hincrbyfloat {key} {field} {increment}</strong> ，hincrby和hincrbyfloat，就像incrby和incrbyfloat命令一样，一个是增加整数，一个是增加浮点数，但是它们的作用域是filed。对一个value使用hincrby，该value和increment需要是整数，否则报错；对一个value使用hincrbyfloat，该value和increment需要是数字，否则报错。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 示例</span><br><span class="line">127.0.0.1:6379&gt; hmset uid v1 1 v2 1.5</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; hincrby uid v1 1</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; hincrby uid v1 1.5</span><br><span class="line">(error) ERR value is not an integer or out of range</span><br><span class="line">127.0.0.1:6379&gt; hincrbyfloat uid v2 1.5</span><br><span class="line">&quot;3&quot;</span><br><span class="line">127.0.0.1:6379&gt; hincrbyfloat uid v2 abc</span><br><span class="line">(error) ERR value is not a valid float</span><br><span class="line">127.0.0.1:6379&gt; hincrbyfloat uid v1 1.5</span><br><span class="line">&quot;3.5&quot;</span><br><span class="line">127.0.0.1:6379&gt; hincrbyfloat uid v2 1e5</span><br><span class="line">&quot;100003&quot;</span><br></pre></td></tr></table></figure>
<hr>
<p>&amp;emsp;&amp;emsp;下图是哈希类型命令的时间复杂度。<br><img src="https://s2.loli.net/2022/03/25/TxiH5vJnFPakh7R.jpg" alt="哈希类型命令的时间复杂度"></p>
<hr>
<h2 id="4-使用场景"><a href="#4-使用场景" class="headerlink" title="4. 使用场景"></a>4. 使用场景</h2><h3 id="1-缓存用户信息"><a href="#1-缓存用户信息" class="headerlink" title="1.缓存用户信息"></a>1.缓存用户信息</h3><p>&amp;emsp;&amp;emsp;可以将关系型数据库中记录的用户信息使用Hash类型进行缓存。相比于使用字符串序列化缓存用户信息，哈希类型变得更加直观，并且在更新操作上会更加便捷。可以将每个用户的id定义为键后缀，多对field-value对应每个用户的属性。<br><img src="https://s2.loli.net/2022/03/25/TmoIc7PC3HK6ukR.jpg"><br>&amp;emsp;&amp;emsp;但是需要注意的是哈希类型和关系型数据库有两点不同之处：</p>
<li>哈希类型是稀疏的，而关系型数据库是完全结构化的，例如哈希类型每个键可以有不同的field，而关系型数据库一旦添加新的列，所有行都要为其设置值（即使为NULL），如图2-17所示。 <p></p>
<li>关系型数据库可以做复杂的关系查询，而Redis去模拟关系型复杂查询开发困难，维护成本高。

<p><img src="https://s2.loli.net/2022/03/25/CZ9IxGHnEDpRXOQ.jpg" alt="图2-17"></p>
<p>&amp;emsp;&amp;emsp;开发人员需要将两者的特点搞清楚，才能在适合的场景使用适合的技术。到目前为止，我们已经能够用三种方法缓存用户信息，下面给出三种方案的实现方法和优缺点分析:<br><br>&amp;emsp;&amp;emsp;<strong>1. 原生字符串类型：每个属性一个键。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set user:1:name tom </span><br><span class="line">set user:1:age 23 </span><br><span class="line">set user:1:city beijing</span><br></pre></td></tr></table></figure>
<p>&amp;emsp;&amp;emsp;优点：简单直观，每个属性都支持更新操作。<br><br>&amp;emsp;&amp;emsp;缺点占用过多的键，内存占用量较大，同时用户信息内聚性比较差， 所以此种方案一般不会在生产环境使用。</p>
<hr>
<p>&amp;emsp;&amp;emsp;<strong>2. 序列化字符串类型：将用户信息序列化后用一个键保存。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set user:1 serialize(userInfo)</span><br></pre></td></tr></table></figure>
<p>&amp;emsp;&amp;emsp;优点：简化编程，如果合理的使用序列化可以提高内存的使用效率。<br><br>&amp;emsp;&amp;emsp;缺点：序列化和反序列化有一定的开销，同时每次更新属性都需要把全部数据取出进行反序列化，更新后再序列化到Redis中。</p>
<hr>
<p>&amp;emsp;&amp;emsp;<strong>3. 哈希类型：每个用户属性使用一对field-value，但是只用一个键保存。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hmset user:1 name tomage 23 city beijing</span><br></pre></td></tr></table></figure>
<p>&amp;emsp;&amp;emsp;优点：简单直观，如果使用合理可以减少内存空间的使用。<br><br>&amp;emsp;&amp;emsp;缺点：要控制哈希在listpack和hashtable两种内部编码的转换，hashtable会消耗更多内存。</p>
<hr>
<h2 id="5-关于hash的奇怪现象与源码分析"><a href="#5-关于hash的奇怪现象与源码分析" class="headerlink" title="5. 关于hash的奇怪现象与源码分析"></a>5. 关于hash的奇怪现象与源码分析</h2><p>&amp;emsp;&amp;emsp;没错，小破站站长金毛又无聊瞎搞Redis中的hash试出了奇怪的现象！不过这次的奇怪现象仅有一个，那就是：<strong>hincrbyfloat无法改变内部编码</strong>。什么意思呢？就是说值超过hash_max_listpack_value（默认64字节），内部编码类型应该从listpack转变为hashtable，但是使用incrbyfloat无论变得多大都不会改变内部编码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 现象如下</span><br><span class="line">127.0.0.1:6379&gt; hset uid v1 1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hincrbyfloat uid v1 1e65</span><br><span class="line">&quot;99999999999999999209038626283633850822756121694230455365568299008&quot;</span><br><span class="line"></span><br><span class="line"># 使用hincrbyfloat令v1增加至长度65后</span><br><span class="line">127.0.0.1:6379&gt; hstrlen uid v1</span><br><span class="line">(integer) 65</span><br><span class="line">127.0.0.1:6379&gt; object encoding uid</span><br><span class="line">&quot;ziplist&quot;</span><br><span class="line">127.0.0.1:6379&gt; hincrbyfloat uid v1 1e1000</span><br><span class="line">&quot;100000000000000005803618566936201790133866835549086831587374......959939072&quot;</span><br><span class="line">127.0.0.1:6379&gt; hstrlen uid v1</span><br><span class="line">(integer) 1001</span><br><span class="line">127.0.0.1:6379&gt; object encoding uid</span><br><span class="line">&quot;ziplist&quot;</span><br><span class="line">127.0.0.1:6379&gt; hset uid v1 aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; hstrlen uid v1</span><br><span class="line">(integer) 74</span><br><span class="line">127.0.0.1:6379&gt; object encoding uid</span><br><span class="line">&quot;hashtable&quot;</span><br></pre></td></tr></table></figure>
<hr>
<p>&amp;emsp;&amp;emsp;为什么会出现这种现象呢？金毛站长带着疑惑打开了t_hash.c文件进行源码分析，让我们来看看hincrbyfloat的源代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">hincrbyfloatCommand</span><span class="params">(client *c)</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">double</span> value, incr;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line">    robj *o;</span><br><span class="line">    sds new;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> *vstr;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> vlen;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (getLongDoubleFromObjectOrReply(c,c-&gt;argv[<span class="number">3</span>],&amp;incr,<span class="literal">NULL</span>) != C_OK) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> ((o = hashTypeLookupWriteOrCreate(c,c-&gt;argv[<span class="number">1</span>])) == <span class="literal">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (hashTypeGetValue(o,c-&gt;argv[<span class="number">2</span>]-&gt;ptr,&amp;vstr,&amp;vlen,&amp;ll) == C_OK) &#123;</span><br><span class="line">        <span class="keyword">if</span> (vstr) &#123;</span><br><span class="line">            <span class="keyword">if</span> (string2ld((<span class="type">char</span>*)vstr,vlen,&amp;value) == <span class="number">0</span>) &#123;</span><br><span class="line">                addReplyError(c,<span class="string">&quot;hash value is not a float&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            value = (<span class="type">long</span> <span class="type">double</span>)ll;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        value = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    value += incr;</span><br><span class="line">    <span class="keyword">if</span> (isnan(value) || isinf(value)) &#123;</span><br><span class="line">        addReplyError(c,<span class="string">&quot;increment would produce NaN or Infinity&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buf[MAX_LONG_DOUBLE_CHARS];</span><br><span class="line">    <span class="type">int</span> len = ld2string(buf,<span class="keyword">sizeof</span>(buf),value,LD_STR_HUMAN);</span><br><span class="line">    new = sdsnewlen(buf,len);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//重点</span></span><br><span class="line">    hashTypeSet(o,c-&gt;argv[<span class="number">2</span>]-&gt;ptr,new,HASH_SET_TAKE_VALUE);</span><br><span class="line">    addReplyBulkCBuffer(c,buf,len);</span><br><span class="line">    signalModifiedKey(c,c-&gt;db,c-&gt;argv[<span class="number">1</span>]);</span><br><span class="line">    notifyKeyspaceEvent(NOTIFY_HASH,<span class="string">&quot;hincrbyfloat&quot;</span>,c-&gt;argv[<span class="number">1</span>],c-&gt;db-&gt;id);</span><br><span class="line">    server.dirty++;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Always replicate HINCRBYFLOAT as an HSET command with the final value</span></span><br><span class="line"><span class="comment">     * in order to make sure that differences in float precision or formatting</span></span><br><span class="line"><span class="comment">     * will not create differences in replicas or after an AOF restart. */</span></span><br><span class="line">    robj *newobj;</span><br><span class="line">    newobj = createRawStringObject(buf,len);</span><br><span class="line">    rewriteClientCommandArgument(c,<span class="number">0</span>,shared.hset);</span><br><span class="line">    rewriteClientCommandArgument(c,<span class="number">3</span>,newobj);</span><br><span class="line">    decrRefCount(newobj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&amp;emsp;&amp;emsp;这里有一句hashTypeSet，看名字是和哈希内部编码有关，进去看看它的实现是什么样的：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">hashTypeSet</span><span class="params">(robj *o, sds field, sds value, <span class="type">int</span> flags)</span> &#123;</span><br><span class="line">    <span class="type">int</span> update = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (o-&gt;encoding == OBJ_ENCODING_LISTPACK) &#123;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> *zl, *fptr, *vptr;</span><br><span class="line"></span><br><span class="line">        zl = o-&gt;ptr;</span><br><span class="line">        fptr = lpFirst(zl);</span><br><span class="line">        <span class="keyword">if</span> (fptr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            fptr = lpFind(zl, fptr, (<span class="type">unsigned</span> <span class="type">char</span>*)field, sdslen(field), <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (fptr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">                <span class="comment">/* Grab pointer to the value (fptr points to the field) */</span></span><br><span class="line">                vptr = lpNext(zl, fptr);</span><br><span class="line">                serverAssert(vptr != <span class="literal">NULL</span>);</span><br><span class="line">                update = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">/* Replace value */</span></span><br><span class="line">                zl = lpReplace(zl, &amp;vptr, (<span class="type">unsigned</span> <span class="type">char</span>*)value, sdslen(value));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!update) &#123;</span><br><span class="line">            <span class="comment">/* Push new field/value pair onto the tail of the listpack */</span></span><br><span class="line">            zl = lpAppend(zl, (<span class="type">unsigned</span> <span class="type">char</span>*)field, sdslen(field));</span><br><span class="line">            zl = lpAppend(zl, (<span class="type">unsigned</span> <span class="type">char</span>*)value, sdslen(value));</span><br><span class="line">        &#125;</span><br><span class="line">        o-&gt;ptr = zl;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Check if the listpack needs to be converted to a hash table */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//关键</span></span><br><span class="line">        <span class="keyword">if</span> (hashTypeLength(o) &gt; server.hash_max_listpack_entries)</span><br><span class="line">            hashTypeConvert(o, OBJ_ENCODING_HT);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (o-&gt;encoding == OBJ_ENCODING_HT) &#123;</span><br><span class="line">        dictEntry *de = dictFind(o-&gt;ptr,field);</span><br><span class="line">        <span class="keyword">if</span> (de) &#123;</span><br><span class="line">            sdsfree(dictGetVal(de));</span><br><span class="line">            <span class="keyword">if</span> (flags &amp; HASH_SET_TAKE_VALUE) &#123;</span><br><span class="line">                dictGetVal(de) = value;</span><br><span class="line">                value = <span class="literal">NULL</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dictGetVal(de) = sdsdup(value);</span><br><span class="line">            &#125;</span><br><span class="line">            update = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sds f,v;</span><br><span class="line">            <span class="keyword">if</span> (flags &amp; HASH_SET_TAKE_FIELD) &#123;</span><br><span class="line">                f = field;</span><br><span class="line">                field = <span class="literal">NULL</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                f = sdsdup(field);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (flags &amp; HASH_SET_TAKE_VALUE) &#123;</span><br><span class="line">                v = value;</span><br><span class="line">                value = <span class="literal">NULL</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                v = sdsdup(value);</span><br><span class="line">            &#125;</span><br><span class="line">            dictAdd(o-&gt;ptr,f,v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        serverPanic(<span class="string">&quot;Unknown hash encoding&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Free SDS strings we did not referenced elsewhere if the flags</span></span><br><span class="line"><span class="comment">     * want this function to be responsible. */</span></span><br><span class="line">    <span class="keyword">if</span> (flags &amp; HASH_SET_TAKE_FIELD &amp;&amp; field) sdsfree(field);</span><br><span class="line">    <span class="keyword">if</span> (flags &amp; HASH_SET_TAKE_VALUE &amp;&amp; value) sdsfree(value);</span><br><span class="line">    <span class="keyword">return</span> update;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>&amp;emsp;&amp;emsp;我们看到这里只有一个判断”if (hashTypeLength(o) &gt; server.hash_max_listpack_entries)hashTypeConvert(o, OBJ_ENCODING_HT);”，这个判断只判断了field的数量是不是大于限制(512)，而并没有对于值长度的判断。所以这也就解释了为什么无论hincrbyfloat能有多长都不会修改内部编码。另外，hincrby的代码也是一样的，只判断了数量，但由于整数有限制并不会达到65字节，所以一般来说不改源码，hincrby是不会出现这种奇怪现象的。</p>
<hr>
<h2 id="6-杂谈"><a href="#6-杂谈" class="headerlink" title="6. 杂谈"></a>6. 杂谈</h2><p>&amp;emsp;&amp;emsp;今天花了半天的时间来研究这个hincrby和hincrbyfloat为什么不判断value的长度，思来想去都想不到一个很好的理由，所以就开始着手了修这个可能的bug。虽然只添加了6行代码，但花了很多时间来确定要不要这么写，理由是什么。因为社恐又怕PR了因为没必要被老外说教。不过经过很长时间的思想斗争，现在还是带着翻译来的撇脚英文commit来PR了。反正无论成不成功，我都不亏鸭!成功了成为贡献者，不成功还能得到大佬的解答。嘻嘻！<br><br><a target="_blank" rel="noopener" href="https://github.com/redis/redis/pull/10479">https://github.com/redis/redis/pull/10479</a><br><br>&amp;emsp;&amp;emsp;欢迎来看github对线现场。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="http://example.com">Jiang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2022/03/24/redis-study-3/">http://example.com/2022/03/24/redis-study-3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Redis/">Redis</a><a class="post-meta__tags" href="/tags/Redis-API/">Redis API</a></div><div class="post_share"><div class="social-share" data-image="/img/AVA.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/03/27/os_study_6/"><img class="prev-cover" src="/img/WIF2.png" onerror="onerror=null;src='/img/AVA.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">THU《操作系统》学习笔记——原理4：物理内存管理：非连续内存分配</div></div></a></div><div class="next-post pull-right"><a href="/2022/03/23/redis-study-2/"><img class="next-cover" src="/true" onerror="onerror=null;src='/img/AVA.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Redis学习笔记（2）：字符串类型基本API</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2022/03/23/redis-study-2/" title="Redis学习笔记（2）：字符串类型基本API"><img class="cover" src="/true" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-23</div><div class="title">Redis学习笔记（2）：字符串类型基本API</div></div></a></div><div><a href="/2022/04/02/redis-study-4/" title="Redis学习笔记（4）：list类型API大全(Redis 7.0)"><img class="cover" src="/img/WIF2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-02</div><div class="title">Redis学习笔记（4）：list类型API大全(Redis 7.0)</div></div></a></div><div><a href="/2022/04/08/redis-study-5/" title="Redis学习笔记（5）：set类型API大全(Redis 7.0)"><img class="cover" src="/img/WIF2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-08</div><div class="title">Redis学习笔记（5）：set类型API大全(Redis 7.0)</div></div></a></div><div><a href="/2022/04/21/redis-study-6/" title="Redis学习笔记（6）：zset类型API大全(Redis 7.0)"><img class="cover" src="/true" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-21</div><div class="title">Redis学习笔记（6）：zset类型API大全(Redis 7.0)</div></div></a></div><div><a href="/2022/03/18/redis-study-1/" title="Redis学习笔记（1）：Redis的8个重要特性"><img class="cover" src="/img/WIF2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-18</div><div class="title">Redis学习笔记（1）：Redis的8个重要特性</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/AVA.jpg" onerror="this.onerror=null;this.src='/img/AVA.jpg'" alt="avatar"/></div><div class="author-info__name">Jiang</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%883%EF%BC%89%EF%BC%9AHash%E7%B1%BB%E5%9E%8B%E5%9F%BA%E6%9C%ACAPI"><span class="toc-number">1.</span> <span class="toc-text">Redis学习笔记（3）：Hash类型基本API</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Hash%E7%B1%BB%E5%9E%8B%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">1. Hash类型基本介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Hash%E7%B1%BB%E5%9E%8B%E5%86%85%E9%83%A8%E7%BC%96%E7%A0%81%E7%AE%80%E4%BB%8B"><span class="toc-number">1.2.</span> <span class="toc-text">2.Hash类型内部编码简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Hash%E5%9F%BA%E6%9C%ACAPI"><span class="toc-number">1.3.</span> <span class="toc-text">3. Hash基本API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hset%E5%91%BD%E4%BB%A4%EF%BC%9A"><span class="toc-number">1.3.1.</span> <span class="toc-text">hset命令：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hmset%E5%91%BD%E4%BB%A4%EF%BC%9A"><span class="toc-number">1.3.2.</span> <span class="toc-text">hmset命令：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hget%E5%91%BD%E4%BB%A4%EF%BC%9A"><span class="toc-number">1.3.3.</span> <span class="toc-text">hget命令：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hmget%E5%91%BD%E4%BB%A4%EF%BC%9A"><span class="toc-number">1.3.4.</span> <span class="toc-text">hmget命令：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hdel%E5%91%BD%E4%BB%A4%EF%BC%9A"><span class="toc-number">1.3.5.</span> <span class="toc-text">hdel命令：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hlen%E5%91%BD%E4%BB%A4%EF%BC%9A"><span class="toc-number">1.3.6.</span> <span class="toc-text">hlen命令：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hexists%E5%91%BD%E4%BB%A4%EF%BC%9A"><span class="toc-number">1.3.7.</span> <span class="toc-text">hexists命令：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hkeys%E5%91%BD%E4%BB%A4%EF%BC%9A"><span class="toc-number">1.3.8.</span> <span class="toc-text">hkeys命令：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hvals%E5%91%BD%E4%BB%A4%EF%BC%9A"><span class="toc-number">1.3.9.</span> <span class="toc-text">hvals命令：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hgetall%E5%91%BD%E4%BB%A4%EF%BC%9A"><span class="toc-number">1.3.10.</span> <span class="toc-text">hgetall命令：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hincrby-x2F-hincrbyfloat%E5%91%BD%E4%BB%A4%EF%BC%9A"><span class="toc-number">1.3.11.</span> <span class="toc-text">hincrby&#x2F;hincrbyfloat命令：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.4.</span> <span class="toc-text">4. 使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%BC%93%E5%AD%98%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.1.</span> <span class="toc-text">1.缓存用户信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%85%B3%E4%BA%8Ehash%E7%9A%84%E5%A5%87%E6%80%AA%E7%8E%B0%E8%B1%A1%E4%B8%8E%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">1.5.</span> <span class="toc-text">5. 关于hash的奇怪现象与源码分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%9D%82%E8%B0%88"><span class="toc-number">1.6.</span> <span class="toc-text">6. 杂谈</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/05/15/%E9%9D%A2%E8%B0%88/" title="面谈个人简介">面谈个人简介</a><time datetime="2022-05-15T12:12:02.000Z" title="Created 2022-05-15 20:12:02">2022-05-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/05/15/GoldFlake_2/" title="GoldFlake：API使用文档">GoldFlake：API使用文档</a><time datetime="2022-05-15T02:10:35.000Z" title="Created 2022-05-15 10:10:35">2022-05-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/05/12/GoldFlake/" title="GoldFlake：与竞争对手斗智斗勇！突发奇想的非连续时间戳雪花算法版本！">GoldFlake：与竞争对手斗智斗勇！突发奇想的非连续时间戳雪花算法版本！</a><time datetime="2022-05-11T16:00:35.000Z" title="Created 2022-05-12 00:00:35">2022-05-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/04/21/redis-study-6/" title="Redis学习笔记（6）：zset类型API大全(Redis 7.0)">Redis学习笔记（6）：zset类型API大全(Redis 7.0)</a><time datetime="2022-04-21T12:00:35.000Z" title="Created 2022-04-21 20:00:35">2022-04-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/04/16/os_study_7/" title="THU《操作系统》学习笔记——实验2：物理内存管理">THU《操作系统》学习笔记——实验2：物理内存管理</a><time datetime="2022-04-16T09:12:31.000Z" title="Created 2022-04-16 17:12:31">2022-04-16</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Jiang</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>